<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bible Study Journal</title>
<style>
:root{
    --bg:#f5f5f5;
    --panel:#ffffff;
    --text:#333;
    --soft:#ecf0f1;
    --accent:#3498db;
}
body.dark{
    --bg:#121212;
    --panel:#1e1e1e;
    --text:#eaeaea;
    --soft:#2a2a2a;
}
body{
    font-family:system-ui,Segoe UI,sans-serif;
    background:var(--bg);
    color:var(--text);
    margin:0;
    padding:0;
    transition:.3s;
}
.container{max-width:1400px;margin:auto;padding:20px}
header{background:#2c3e50;color:#fff;padding:18px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;margin-bottom:18px;}
button{border:none;border-radius:6px;padding:8px 14px;background:var(--accent);color:#fff;cursor:pointer;}
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px;}
select,input{padding:6px;border-radius:6px;border:1px solid #ccc;}
.verse-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;}
@media(max-width:900px){.verse-grid{grid-template-columns:1fr 1fr}}
@media(max-width:600px){.verse-grid{grid-template-columns:1fr}}
.verse-box{background:var(--panel);padding:14px;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.08);}
.version-select{width:100%;padding:6px;margin-bottom:8px;}
.verse-display{background:var(--soft);padding:12px;border-radius:6px;line-height:1.7;}
.highlight{background:rgba(241,196,15,.6);cursor:pointer;}
.highlight:hover{background:rgba(241,196,15,.85);}
.compiled-note{background:var(--soft);padding:10px;border-radius:6px;margin-bottom:8px;border-left:4px solid #f1c40f;}
</style>
</head>
<body>
<div id="root"></div>

<!-- React + ReactDOM + Babel -->
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<script type="text/babel">

const { useState, useEffect } = React;

/* ------------------- Versions & Books ------------------- */
const versions = [
  { id: "kjv", label: "KJV" },
  { id: "web", label: "WEB" },
  { id: "asv", label: "ASV" },
  { id: "bbe", label: "BBE" },
  { id: "darby", label: "Darby" },
  { id: "ylt", label: "YLT" },
];

const books = [
"Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth","1 Samuel","2 Samuel",
"1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra","Nehemiah","Esther","Job","Psalms","Proverbs",
"Ecclesiastes","Song of Solomon","Isaiah","Jeremiah","Lamentations","Ezekiel","Daniel","Hosea","Joel",
"Amos","Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai","Zechariah","Malachi",
"Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians","Galatians","Ephesians",
"Philippians","Colossians","1 Thessalonians","2 Thessalonians","1 Timothy","2 Timothy","Titus","Philemon",
"Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude","Revelation"
];

/* ------------------- VersePanel Component ------------------- */
function VersePanel({ index, book, chapter, verse, highlights, setHighlights }) {
  const [version, setVersion] = useState(versions[index % versions.length].id);
  const [text, setText] = useState("Loading‚Ä¶");
  const [cache, setCache] = useState({});

  useEffect(() => {
    loadVerse();
  }, [book, chapter, verse, version]);

  async function loadVerse() {
    const key = `${version}|${book}|${chapter}|${verse}`;
    if (cache[key]) { setText(cache[key]); return; }
    setText("Loading‚Ä¶");
    try {
      const res = await fetch(`https://bible-api.com/${encodeURIComponent(`${book} ${chapter}:${verse}`)}?translation=${version}`);
      const data = await res.json();
      const verseText = data.text || "Verse not found.";
      setText(verseText);
      setCache(prev => ({ ...prev, [key]: verseText }));
    } catch {
      setText("Error loading verse.");
    }
  }

  function toggleHighlight(word, idx) {
    const id = `${index}_${idx}_${book}_${chapter}_${verse}`;
    const existingIndex = highlights.findIndex(h => h.id === id);
    if (existingIndex > -1) {
      const updated = [...highlights]; updated.splice(existingIndex, 1);
      setHighlights(updated);
      localStorage.setItem("highlights", JSON.stringify(updated));
      return;
    }
    const note = prompt("Comment on this highlight:");
    if (!note) return;
    const newHighlight = { id, word, ref: `${book} ${chapter}:${verse}`, note };
    const updated = [...highlights, newHighlight];
    setHighlights(updated);
    localStorage.setItem("highlights", JSON.stringify(updated));
  }

  return (
    <div className="verse-box">
      <select className="version-select" value={version} onChange={e => setVersion(e.target.value)}>
        {versions.map(v => <option key={v.id} value={v.id}>{v.label}</option>)}
      </select>
      <div className="verse-display">
        {text.split(/\s+/).map((word, idx) => {
          const id = `${index}_${idx}_${book}_${chapter}_${verse}`;
          const isHighlighted = highlights.some(h => h.id === id);
          return <span key={id} className={isHighlighted ? "highlight" : ""} onClick={() => toggleHighlight(word, idx)}>{word} </span>;
        })}
      </div>
    </div>
  );
}

/* ------------------- Highlights Component ------------------- */
function Highlights({ highlights }) {
  if (!highlights.length) return <small>No highlights yet.</small>;
  return highlights.map(h => (
    <div key={h.id} className="compiled-note">
      <b>{h.ref}</b><br/>
      <i>{h.word}</i><br/>
      {h.note}
    </div>
  ));
}

/* ------------------- Main App ------------------- */
function App() {
  const [book, setBook] = useState("Genesis");
  const [chapter, setChapter] = useState(1);
  const [verse, setVerse] = useState(1);
  const [highlights, setHighlights] = useState(JSON.parse(localStorage.getItem("highlights")) || []);
  const [dark, setDark] = useState(localStorage.getItem("dark") === "true");

  function toggleDark() {
    setDark(prev => { localStorage.setItem("dark", !prev); return !prev; });
  }

  function reloadAll() { setBook(prev => prev); }

  return (
    <div className={dark ? "dark" : ""}>
      <div className="container">
        <header>
          <div>
            <h2>üìñ Bible Study Journal</h2>
            <small>Instant loading ‚Ä¢ Highlight ‚Ä¢ Reflect</small>
          </div>
          <button className="toggle-btn" onClick={toggleDark}>{dark ? "‚òÄÔ∏è" : "üåô"}</button>
        </header>

        <div className="controls">
          <select value={book} onChange={e => setBook(e.target.value)}>{books.map(b => <option key={b} value={b}>{b}</option>)}</select>
          <input type="number" min="1" value={chapter} onChange={e => setChapter(Number(e.target.value))} />
          <input type="number" min="1" value={verse} onChange={e => setVerse(Number(e.target.value))} />
          <button onClick={reloadAll}>Load</button>
        </div>

        <div className="verse-grid">
          {[...Array(6)].map((_, i) =>
            <VersePanel key={i} index={i} book={book} chapter={chapter} verse={verse} highlights={highlights} setHighlights={setHighlights} />
          )}
        </div>

        <h3 style={{ margin: "20px 0 10px" }}>Highlighted Notes</h3>
        <Highlights highlights={highlights} />
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
