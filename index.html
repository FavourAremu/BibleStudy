<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bible Study Journal</title>

<link rel="icon" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<text y='0.9em' font-size='90'>ðŸ“–</text>
</svg>">

<style>
:root{
  --bg:#f5f5f5;
  --panel:#ffffff;
  --text:#333;
  --soft:#ecf0f1;
  --accent:#3498db;
  --highlight:#f1c40f;
}
body.dark{
  --bg:#121212;
  --panel:#1e1e1e;
  --text:#eaeaea;
  --soft:#2a2a2a;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:.25s;
}
.container{max-width:1400px;margin:auto;padding:16px}

/* Header */
header{
  background:#2c3e50;
  color:#fff;
  padding:14px 16px;
  border-radius:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h2{font-size:1.2rem}
header small{opacity:.85}

/* Dark toggle */
.toggle-btn{
  width:44px;
  height:44px;
  border-radius:50%;
  background:rgba(255,255,255,.2);
  border:none;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:18px;
  cursor:pointer;
}

/* Controls */
.controls{
  margin:16px 0;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
select,button{
  padding:8px 10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}
button{
  background:var(--accent);
  color:#fff;
  border:none;
}

/* Grid */
.verse-grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:14px;
}
@media(max-width:900px){
  .verse-grid{grid-template-columns:repeat(2,1fr)}
}
@media(max-width:600px){
  .verse-grid{grid-template-columns:1fr}
  .toggle-btn{width:38px;height:38px}
}

/* Verse box */
.verse-box{
  background:var(--panel);
  padding:12px;
  border-radius:12px;
  box-shadow:0 2px 4px rgba(0,0,0,.06);
}
.version-select{width:100%;margin-bottom:6px}

.verse-display{
  background:var(--soft);
  padding:10px;
  border-radius:8px;
  line-height:1.7;
  font-size:.95rem;
}

/* Highlight */
.highlight{
  background:rgba(241,196,15,.65);
  border-radius:4px;
  cursor:pointer;
}

/* Notes */
.compiled-note{
  background:var(--soft);
  padding:10px;
  border-radius:8px;
  margin-bottom:8px;
  border-left:4px solid var(--highlight);
}

/* Forms */
#loginForm, #signupForm, #postSection{
  background:var(--panel);
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

#loginForm h3, #signupForm h3, #postSection h3{
  margin-bottom:16px;
  font-size:1.1rem;
  color:var(--text);
}

#loginForm input, #signupForm input{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:14px;
  background:var(--soft);
  color:var(--text);
  transition:border-color .2s;
}

#loginForm input:focus, #signupForm input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(52,152,219,.1);
}

#postSection textarea{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:14px;
  background:var(--soft);
  color:var(--text);
  font-family:inherit;
  resize:vertical;
  min-height:100px;
  transition:border-color .2s;
}

#postSection textarea:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(52,152,219,.1);
}

#loginForm button, #signupForm button, #postSection button{
  width:100%;
  padding:10px;
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:14px;
  font-weight:500;
  cursor:pointer;
  transition:.2s;
}

#loginForm button:hover, #signupForm button:hover, #postSection button:hover{
  background:#2980b9;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(52,152,219,.3);
}
</style>
</head>

<body>
<div class="container">

<header>
  <div>
    <h2>ðŸ“– Bible Study Journal</h2>
    <small>Fast â€¢ Highlight â€¢ Reflect</small>
  </div>
  <div style="display:flex;gap:8px;align-items:center">
    <button class="toggle-btn" onclick="toggleDark()">
      <span id="icon">ðŸŒ™</span>
    </button>
    <button onclick="logout()" style="padding:8px 12px;background:#e74c3c">Logout</button>
  </div>
</header>

<div class="controls">
  <select id="book"></select>
  <select id="chapter"></select>
  <select id="verse"></select>
  <button onclick="reloadAll()">Load</button>
</div>

<div class="verse-grid" id="verseGrid"></div>

<!-- Posting Section -->
<div id="postSection">
  <h3>Post a Question</h3>
  <textarea id="postContent" placeholder="Ask a question..."></textarea>
  <button onclick="postQuestion()">Post</button>
</div>

<h3 style="margin:18px 0 8px">Highlighted Notes</h3>
<div id="highlightNotes"></div>

<button onclick="exportComments()" style="margin-top:16px">Export Comments</button>

</div>

<script>
/* Check if user is authenticated */
if(!localStorage.getItem('userId')){
  window.location.href = 'auth.html';
}

function logout(){
  localStorage.removeItem('userId');
  window.location.href = 'auth.html';
}

/* ---------------- DATA ---------------- */
const versions=[
  {id:"kjv",label:"KJV"},
  {id:"web",label:"WEB"},
  {id:"asv",label:"ASV"},
  {id:"bbe",label:"BBE"},
  {id:"darby",label:"Darby"},
  {id:"ylt",label:"YLT"}
];

const books=[ "Genesis","Exodus","Leviticus","Numbers","Deuteronomy","Joshua","Judges","Ruth",
"1 Samuel","2 Samuel","1 Kings","2 Kings","1 Chronicles","2 Chronicles","Ezra","Nehemiah","Esther",
"Job","Psalms","Proverbs","Ecclesiastes","Song of Solomon","Isaiah","Jeremiah","Lamentations","Ezekiel",
"Daniel","Hosea","Joel","Amos","Obadiah","Jonah","Micah","Nahum","Habakkuk","Zephaniah","Haggai",
"Zechariah","Malachi","Matthew","Mark","Luke","John","Acts","Romans","1 Corinthians","2 Corinthians",
"Galatians","Ephesians","Philippians","Colossians","1 Thessalonians","2 Thessalonians","1 Timothy",
"2 Timothy","Titus","Philemon","Hebrews","James","1 Peter","2 Peter","1 John","2 John","3 John","Jude",
"Revelation"
];

books.forEach(b=>{
  const o=document.createElement("option");
  o.value=b;o.textContent=b;
  document.getElementById("book").appendChild(o);
});

for(let i=1;i<=150;i++){
  const o=document.createElement("option");
  o.value=i;o.textContent=`Chapter ${i}`;
  document.getElementById("chapter").appendChild(o);
}

function populateVerses(){
  document.getElementById("verse").innerHTML="";
  for(let i=1;i<=176;i++){
    const o=document.createElement("option");
    o.value=i;o.textContent=`Verse ${i}`;
    document.getElementById("verse").appendChild(o);
  }
}
populateVerses();
document.getElementById("chapter").onchange=populateVerses;

/* ---------------- FAST LOAD ---------------- */
function preloadAll(){
  document.querySelectorAll(".version-select").forEach((s,i)=>{
    loadVerse(i,s.value);
  });
}

async function loadVerse(i,version){
  const ref=`${book.value} ${chapter.value}:${verse.value}`;
  const key=`${version}|${ref}`;
  const box=document.getElementById(`verse-${i}`);

  if(verseCache[key]){
    renderVerse(box,verseCache[key],ref,i);
    return;
  }
  try{
    const r=await fetch(`https://bible-api.com/${encodeURIComponent(ref)}?translation=${version}`);
    const d=await r.json();
    verseCache[key]=d.text||"Verse not found.";
    renderVerse(box,verseCache[key],ref,i);
  }catch{
    box.textContent="Error loading verse.";
  }
}
function reloadAll(){preloadAll();}

/* ---------------- RENDER ---------------- */
function renderVerse(el,text,ref,section){
  el.innerHTML="";
  text.split(/\s+/).forEach((w,i)=>{
    const id=`${section}_${i}_${ref}`;
    const s=document.createElement("span");
    s.textContent=w+" ";
    if(highlights.some(h=>h.id===id)) s.className="highlight";
    s.onclick=()=>toggleHighlight(id,w,ref);
    el.appendChild(s);
  });
}

/* ---------------- HIGHLIGHT ---------------- */
function toggleHighlight(id,word,ref){
  const i=highlights.findIndex(h=>h.id===id);
  if(i>-1) highlights.splice(i,1);
  else{
    const note=prompt("Comment on this highlight:");
    if(!note) return;
    highlights.push({id,word,ref,note});
  }
  localStorage.setItem("highlights",JSON.stringify(highlights));
  renderNotes();
}

/* ---------------- NOTES ---------------- */
function renderNotes(){
  highlightNotes.innerHTML=
    highlights.map(h=>`
      <div class="compiled-note">
        <b>${h.ref}</b><br>
        <i>${h.word}</i><br>
        ${h.note}
      </div>`).join("") || "<small>No highlights yet.</small>";
}
renderNotes();

</script>
</body>
</html>
