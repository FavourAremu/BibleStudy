<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bible Study Journal - Auth</title>

<link rel="icon" href="data:image/svg+xml,
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>
<text y='0.9em' font-size='90'>ðŸ“–</text>
</svg>">

<style>
:root{
  --bg:#f5f5f5;
  --panel:#ffffff;
  --text:#333;
  --soft:#ecf0f1;
  --accent:#3498db;
}
body.dark{
  --bg:#121212;
  --panel:#1e1e1e;
  --text:#eaeaea;
  --soft:#2a2a2a;
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui,-apple-system,Segoe UI,sans-serif;
  background:var(--bg);
  color:var(--text);
  transition:background-color .3s ease, color .3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  padding:16px;
}

.auth-container{
  max-width:400px;
  width:100%;
  animation:fadeIn .5s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:translateY(0)}
}

.auth-tabs{
  display:flex;
  gap:8px;
  margin-bottom:20px;
}

.auth-tab{
  flex:1;
  padding:10px;
  background:var(--soft);
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-size:14px;
  font-weight:500;
  transition:all .3s ease;
  color:var(--text);
}

.auth-tab:hover{
  transform:translateY(-2px);
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.auth-tab.active{
  background:var(--accent);
  color:#fff;
  box-shadow:0 4px 12px rgba(52,152,219,.3);
}

#loginForm, #signupForm{
  background:var(--panel);
  padding:30px;
  border-radius:12px;
  box-shadow:0 2px 12px rgba(0,0,0,.1);
  display:none;
  animation:slideIn .4s ease;
  transition:opacity .3s ease;
}

@keyframes slideIn{
  from{opacity:0;transform:translateX(20px)}
  to{opacity:1;transform:translateX(0)}
}

#loginForm.active, #signupForm.active{
  display:block;
}

h2{
  margin-bottom:20px;
  font-size:1.5rem;
  color:var(--text);
}

input{
  width:100%;
  padding:10px;
  margin-bottom:12px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:14px;
  background:var(--soft);
  color:var(--text);
  transition:all .2s ease;
}

input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(52,152,219,.1);
  transform:translateY(-2px);
}

button{
  width:100%;
  padding:10px;
  background:var(--accent);
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:14px;
  font-weight:500;
  cursor:pointer;
  transition:all .3s ease;
  position:relative;
  overflow:hidden;
}

button:hover:not(:disabled){
  background:#2980b9;
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(52,152,219,.3);
}

button:active:not(:disabled){
  transform:translateY(0);
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.loading-spinner{
  display:inline-block;
  width:16px;
  height:16px;
  border:2px solid rgba(255,255,255,.3);
  border-top-color:#fff;
  border-radius:50%;
  animation:spin .8s linear infinite;
  margin-right:8px;
  vertical-align:middle;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

#loginError, #signupError{
  margin-top:12px;
  font-size:13px;
  padding:10px;
  border-radius:6px;
  display:none;
  animation:slideDown .3s ease;
}

@keyframes slideDown{
  from{opacity:0;transform:translateY(-10px)}
  to{opacity:1;transform:translateY(0)}
}

#loginError.show, #signupError.show{
  display:block;
}

#loginError{
  color:#fff;
  background:#e74c3c;
}

#signupError{
  color:#fff;
  background:#e74c3c;
}

#signupError.success{
  background:#27ae60;
  color:#fff;
}

.toggle-dark{
  position:fixed;
  top:16px;
  right:16px;
  width:44px;
  height:44px;
  border-radius:50%;
  background:var(--accent);
  border:none;
  color:#fff;
  font-size:18px;
  cursor:pointer;
  transition:all .3s ease;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
}

.toggle-dark:hover{
  transform:scale(1.1) rotate(20deg);
  box-shadow:0 4px 12px rgba(52,152,219,.3);
}

.toggle-dark:active{
  transform:scale(0.95);
}
</style>
</head>

<body>
<div class="auth-container">
  <div class="auth-tabs">
    <button class="auth-tab active" onclick="switchTab('login')">Login</button>
    <button class="auth-tab" onclick="switchTab('signup')">Sign Up</button>
  </div>

  <div id="loginForm" class="active">
    <h2>Login</h2>
    <input type="email" id="loginEmail" placeholder="Email" />
    <input type="password" id="loginPassword" placeholder="Password" />
    <button onclick="login()" id="loginBtn">Login</button>
    <div id="loginError"></div>
  </div>

  <div id="signupForm">
    <h2>Sign Up</h2>
    <input type="email" id="signupEmail" placeholder="Email" />
    <input type="password" id="signupPassword" placeholder="Password" />
    <input type="password" id="signupConfirm" placeholder="Confirm Password" />
    <button onclick="signup()" id="signupBtn">Sign Up</button>
    <div id="signupError"></div>
  </div>

  <button class="toggle-dark" onclick="toggleDark()"><span id="darkIcon">ðŸŒ™</span></button>
</div>

<script>
const API_BASE = 'http://localhost:3000';

function switchTab(tab){
  document.getElementById('loginForm').classList.remove('active');
  document.getElementById('signupForm').classList.remove('active');
  document.querySelectorAll('.auth-tab').forEach(t=>t.classList.remove('active'));
  
  if(tab==='login'){
    document.getElementById('loginForm').classList.add('active');
    document.querySelectorAll('.auth-tab')[0].classList.add('active');
  } else {
    document.getElementById('signupForm').classList.add('active');
    document.querySelectorAll('.auth-tab')[1].classList.add('active');
  }
  clearErrors();
}

function clearErrors(){
  document.getElementById('loginError').textContent='';
  document.getElementById('loginError').classList.remove('show','success');
  document.getElementById('signupError').textContent='';
  document.getElementById('signupError').classList.remove('show','success');
}

function showError(type, message){
  const errorDiv = document.getElementById(`${type}Error`);
  errorDiv.textContent = message;
  errorDiv.classList.add('show');
  errorDiv.classList.remove('success');
}

function showSuccess(type, message){
  const errorDiv = document.getElementById(`${type}Error`);
  errorDiv.textContent = message;
  errorDiv.classList.add('show','success');
}

function setButtonLoading(btn, isLoading){
  if(isLoading){
    btn.disabled = true;
    btn.innerHTML = `<span class="loading-spinner"></span>Loading...`;
  } else {
    btn.disabled = false;
    btn.innerHTML = btn.id === 'loginBtn' ? 'Login' : 'Sign Up';
  }
}

function toggleDark(){
  document.body.classList.toggle('dark');
  const isDark = document.body.classList.contains('dark');
  const icon = document.getElementById('darkIcon');
  icon.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
  localStorage.setItem('dark', isDark);
}

if(localStorage.getItem('dark')==='true'){
  document.body.classList.add('dark');
  document.getElementById('darkIcon').textContent = 'â˜€ï¸';
}

async function login(){
  const email = document.getElementById('loginEmail').value.trim();
  const password = document.getElementById('loginPassword').value;
  const btn = document.getElementById('loginBtn');
  
  clearErrors();
  
  if(!email || !password){
    showError('login', 'Please enter email and password.');
    return;
  }
  
  if(!validateEmail(email)){
    showError('login', 'Please enter a valid email.');
    return;
  }
  
  setButtonLoading(btn, true);
  
  try{
    const res = await fetch(`${API_BASE}/api/login`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email, password})
    });
    
    const data = await res.json();
    
    if(data.success){
      localStorage.setItem('userId', data.userId);
      localStorage.setItem('userEmail', data.email);
      showSuccess('login', 'Login successful! Redirecting...');
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 600);
    } else {
      showError('login', data.message || 'Login failed. Please try again.');
      setButtonLoading(btn, false);
    }
  } catch(err){
    showError('login', 'Connection error: ' + err.message);
    setButtonLoading(btn, false);
  }
}

async function signup(){
  const email = document.getElementById('signupEmail').value.trim();
  const password = document.getElementById('signupPassword').value;
  const confirm = document.getElementById('signupConfirm').value;
  const btn = document.getElementById('signupBtn');
  
  clearErrors();
  
  if(!email || !password || !confirm){
    showError('signup', 'Please fill all fields.');
    return;
  }
  
  if(!validateEmail(email)){
    showError('signup', 'Please enter a valid email.');
    return;
  }
  
  if(password.length < 6){
    showError('signup', 'Password must be at least 6 characters.');
    return;
  }
  
  if(password !== confirm){
    showError('signup', 'Passwords do not match.');
    return;
  }
  
  setButtonLoading(btn, true);
  
  try{
    const res = await fetch(`${API_BASE}/api/signup`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({email, password})
    });
    
    const data = await res.json();
    
    if(data.success){
      showSuccess('signup', 'Signup successful! Redirecting to login...');
      setTimeout(() => {
        document.getElementById('signupEmail').value = '';
        document.getElementById('signupPassword').value = '';
        document.getElementById('signupConfirm').value = '';
        switchTab('login');
        document.getElementById('loginEmail').value = email;
        setButtonLoading(btn, false);
      }, 1500);
    } else {
      showError('signup', data.message || 'Signup failed. Please try again.');
      setButtonLoading(btn, false);
    }
  } catch(err){
    showError('signup', 'Connection error: ' + err.message);
    setButtonLoading(btn, false);
  }
}

function validateEmail(email){
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}
</script>
</body>
</html>
